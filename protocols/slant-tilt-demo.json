{"id":24378,"title":"slant_tilt_demo","title_html":"slant_tilt_demo","image":{"source":"https:\/\/www.protocols.io\/img\/default_protocol.png","placeholder":"https:\/\/www.protocols.io\/img\/default_protocol.png"},"doi":"dx.doi.org\/10.17504\/protocols.io.322gqge","doi_status":2,"uri":"slant-tilt-demo-322gqge","type_id":1,"published_on":1560266181,"parent_protocols":[],"parent_collections":[],"version_id":0,"created_on":1560265615,"categories":null,"creator":{"name":"Monica Li","affiliation":null,"affiliations":[],"username":"monica-li","link":null,"image":{"source":"\/img\/avatars\/013.png","placeholder":"\/img\/avatars\/013.png"},"badges":[{"id":2,"image":{"source":"\/img\/badges\/bronze.svg","placeholder":"\/img\/badges\/bronze.svg"},"name":"Author"}],"research_interests":null,"blocked_by_you":false,"blocked_you":false},"journal":null,"journal_name":null,"journal_link":null,"article_citation":null,"public":1,"has_versions":0,"link":null,"total_collections":0,"number_of_steps":3,"authors":[{"name":"Monica Li","affiliation":"City University of Hong Kong","affiliations":[],"username":"monica-li","link":null,"image":{"source":"\/img\/avatars\/013.png","placeholder":"\/img\/avatars\/013.png"},"badges":[],"research_interests":null,"blocked_by_you":false,"blocked_you":false}],"versions":[],"groups":[],"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"can_be_copied":1,"can_remove_fork":1,"forks_count":{"private":0,"public":0},"access":{"can_view":1,"can_remove":0,"can_add":0,"can_edit":0,"can_publish":0,"can_get_doi":0,"can_share":1,"can_move":1,"can_move_outside":1,"can_transfer":1,"can_download":1,"is_locked":0},"steps":[{"id":754536,"guid":"8CC1D7D08C5A11E9ACEC03B5CA2CF3FE","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"10E2D07068ED40F28685FF036F745BC8","order_id":1,"type_id":6,"title":"Section","source":{"title":"Main"}},{"id":1054724,"guid":"72F9F9A9555144B8BA1F9EB057309D24","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Get the writing data from a digital tablet as attached. <\/div><\/div>"}},{"id":1054725,"guid":"E3FB67008C5A11E9ACEC03B5CA2CF3FE","order_id":2,"type_id":23,"title":"file","source":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/bakiww.","placeholder":"","original_name":"example.pkl"}}],"cases":null,"data":null,"section":null,"section_color":null,"duration":0},{"id":754537,"guid":"E647A0F08C5A11E9ACEC03B5CA2CF3FE","previous_id":754536,"previous_guid":"8CC1D7D08C5A11E9ACEC03B5CA2CF3FE","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"416E3F7C42764AB1AE323CF85C427ABF","order_id":1,"type_id":6,"title":"Section","source":{"title":""}},{"id":1054724,"guid":"047C5394FD6E40B7A82043977DDDDCA2","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Download the data and the command in script, save them in the same folder<\/div><\/div>"}},{"id":1054725,"guid":"EC630B508C5A11E9ACEC03B5CA2CF3FE","order_id":2,"type_id":15,"title":"command","source":{"id":6307,"name":"# coding: utf-8\n\n# In[ ]:\n\n\nimport pandas as pd\nimport numpy as np\nfrom sklearn import linear_model\n#from sklearn.metrics import mean_squared_error, r2_score, explained_variance_score\nSTROKE = 'STROKE'\nCHARACTER = 'CHARACTER'\n\n\n# In[ ]:\n\n\n#Judge whether a stroke is vertial or horizonal\ndef vert(chardf):\n    regrv = linear_model.LinearRegression()\n    regrh = linear_model.LinearRegression()\n    newdf = pd.DataFrame(columns =['SAMPLE','CHARACTER','STROKE','POINT','X','Y','Z','Vertical'])\n    for i in range(chardf[STROKE].max()+1):\n        chardfX = chardf.loc[chardf.STROKE == i].loc[:,['X']]\n        chardfY = chardf.loc[chardf.STROKE == i].loc[:,['Y']]\n        regrv.fit(chardfX, chardfY)\n        regrh.fit(chardfY, chardfX)\n        slope = regrv.coef_[0]\n        slope_r = regrh.coef_[0]\n        #vertical stroke\n        if (slope_r > -0.5773) and (slope_r < 0.5773):\n            vertdf = chardf.loc[chardf.STROKE == i].assign(Vertical = 1)\n            newdf = newdf.append(vertdf)\n         #horizontal stroke\n        elif (slope <0.3839) and (slope > -0.8098):\n            vertdf = chardf.loc[chardf.STROKE == i].assign(Vertical = -1)\n            newdf = newdf.append(vertdf)\n        else:\n            vertdf = chardf.loc[chardf.STROKE == i]\n            newdf = newdf.append(vertdf)\n    return newdf\n\n\n# In[ ]:\n\n\n#read file\ndf = pd.read_pickle('example.pkl')\n\n\n# In[ ]:\n\n\n#calculate linear regression result\ndf = df.assign(Vertical = 0)\ncharlist = df.loc[:,'CHARACTER'].drop_duplicates().tolist()\nwholedf = pd.DataFrame()\nfor i in charlist:\n    wholedf =wholedf.append(vert(df.loc[(df.CHARACTER == i)]))\n\n\n# In[ ]:\n\n\nraw = wholedf[['CHARACTER', 'STROKE', 'POINT','X', 'Y', 'Vertical']]\nnew = pd.DataFrame(columns = ['CHARACTER', 'STROKE', 'POINT','X', 'Y', 'Vertical'])\nnew = new.append(raw.iloc[0])\n\n\n# In[ ]:\n\n\n#drop the points too close to each other\ncount = 0\nwhile count < raw.shape[0]:    \n    x0 = raw.iloc[0]['X']\n    y0 = raw.iloc[0]['Y']\n    if (raw.iloc[count][3] - x0)**2 + (raw.iloc[count][4] - y0)**2 < 100:\n        count += 1        \n    else:\n        new = new.append(raw.iloc[count])\n        raw = raw.iloc[count+1:]\n        count = 0\n#take difference and calculate angle\nnew['X_diff'] = np.nan\nnew['Y_diff'] = np.nan\nnew['Angle'] = np.nan\nfor i in range(1,new.shape[0]):\n    if new.iloc[i,1] == new.iloc[i-1,1]:\n        new.iloc[i,6] = new.iloc[i,3]-new.iloc[i-1,3]\n        new.iloc[i,7] = new.iloc[i,4]-new.iloc[i-1,4]\n        new.iloc[i,8] = round(np.angle(complex(new.iloc[i,6],new.iloc[i,7]),deg = True))\n\n\n# In[ ]:\n\n\n#prepare data for slant and tile calculation\nnew = new.dropna()\nslantdf = new[new['Vertical']==1]\ntiltdf = new[new['Vertical']==-1]\n\n\n# In[ ]:\n\n\nprint(\"slant: \", slantdf['Angle'].mode()[0], \", tilt:\", tiltdf['Angle'].mode()[0])","command_name":"slant_tilt_demo, step 2","command":"A demonstration for \"Measuring the tilt and slant of Chinese handwriting in primary school students: A computerized approach\"","os_name":"python","os_version":"3.6"}}],"cases":null,"data":null,"section":null,"section_color":null,"duration":0},{"id":754538,"guid":"67B071808C5B11E9B0B779ABC6CF2966","previous_id":754537,"previous_guid":"E647A0F08C5A11E9ACEC03B5CA2CF3FE","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"E024809F13374E0286038ACE038B4EF1","order_id":1,"type_id":6,"title":"Section","source":{"title":""}},{"id":1054724,"guid":"41F82CEF790343FDB4BF3A9D539CBB84","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Run the command<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null,"duration":0}],"materials":[],"description":"","changed_on":1560266181}