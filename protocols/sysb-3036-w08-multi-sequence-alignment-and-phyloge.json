{"id":18289,"title":"SYSB 3036 W08: Multi-Sequence Alignment and Phylogenetics","title_html":"SYSB 3036 W08: Multi-Sequence Alignment and Phylogenetics","image":{"source":"https:\/\/www.protocols.io\/img\/default_protocol.png","placeholder":"https:\/\/www.protocols.io\/img\/default_protocol.png"},"doi":"dx.doi.org\/10.17504\/protocols.io.v4re8v6","doi_status":2,"uri":"sysb-3036-w08-multi-sequence-alignment-and-phyloge-v4re8v6","type_id":1,"published_on":1552771819,"version_id":0,"created_on":1543891301,"categories":null,"creator":{"name":"Frank Aylward","affiliation":"Virginia Tech","username":"frank-aylward","link":null,"image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/v39jtte.png","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/v39jtte.png"},"badges":[{"id":4,"image":{"source":"\/img\/badges\/gold.svg","placeholder":"\/img\/badges\/gold.svg"},"name":"Gold power author!"}],"research_interests":null},"journal":null,"journal_name":null,"journal_link":null,"public":1,"has_versions":0,"link":null,"total_collections":0,"number_of_steps":11,"authors":[{"name":"Frank Aylward","affiliation":"Virginia Tech","username":"frank-aylward","link":null,"image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/v39jtte.png","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/v39jtte.png"},"badges":[],"research_interests":null}],"versions":[],"groups":[],"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"forks_count":{"private":0,"public":0},"steps":[{"id":689600,"guid":"00E48A10FC9E11E8B54C97C0DC530A31","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"340132ABE4AE4CAF99E7C3800C7F12EC","order_id":1,"type_id":6,"title":"Section","source":{"title":"Get the data"}},{"id":1054724,"guid":"0EE58679F44F4C8BB7E7DC1301FAE451","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">First we will download some files from GitHub from a repository called \"phylogenetics_tutorial\":<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">git clone <\/span><\/div><div class = \"text-block\"><a style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">https:\/\/github.com\/faylward\/phylogenetics_tutorial<\/span><\/a><\/div><div class = \"text-block\">and then we will move into the new folder and see what files are present:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">cd phylogenetics_tutorial<\/span><\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">ls -lh<\/span><\/div><div class = \"text-block\">You should see a file called SSU_seqs.fna. This file contains some Small Subunit (SSU) rRNA genes, also called 16S rRNA genes, that we will use to practice multi-sequence alignment and phylogenetic inference. Every SSU gene here comes from a different microbe, and by examining these genes we can begin to reconstruct the evolutionary relationships between different groups. SSU rRNA genes are often used for this purpose, and in general these genes are considered great \"phylogenetic markers\" since they are highly conserved and present in all cellular life (they are necessary for functioning of the ribosome). <\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#A492FF"},{"id":689601,"guid":"B04F27D0FC9E11E8B54C97C0DC530A31","previous_id":689600,"previous_guid":"00E48A10FC9E11E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"BD6DE7DBF3C14461A5C52B4464D513B7","order_id":1,"type_id":6,"title":"Section","source":{"title":"Look at the sequences"}},{"id":1054724,"guid":"7B94F62CECD64184BF897F0851F67197","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Let's take a quick look at the sequences. <\/div><div class = \"text-block\">Using Unix head:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">head SSU_seqs.fna<\/span><\/div><div class = \"text-block\">And seqkit:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">seqkit fx2tab -l -g -n SSU_seqs.fna<\/span><\/div><div class = \"text-block\">You should find 8 sequences in FASTA format that vary in length between 1,250-1,530 bp. This is pretty typical for full length SSU rRNA genes. Note that the GC content varies between groups- this is also typical. <\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#94EBFF"},{"id":689602,"guid":"0E33B730FC9F11E8B54C97C0DC530A31","previous_id":689601,"previous_guid":"B04F27D0FC9E11E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"CEB5FA16D7EB4D29BA82CEE021C32659","order_id":1,"type_id":6,"title":"Section","source":{"title":"Look at Clustal Omega options"}},{"id":1054724,"guid":"2032A2DF2DFB40CF991E2FA1E7F2204C","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Now that we have an idea of what the file looks like we can start the sequence alignment. The alignment we need to do here is different from the alignment we did in the past with BLAST or any other homology search tool. That's because here we will be using the alignments for phylogenetic inference, so we need to be super careful that each bp is aligned as accurately as possible. With BLAST we were mainly interested in the alignment summary statistics like the e-value, % identity, and bit score. But here we will be interested in each and every location in the resulting alignment, so we must be very careful. <\/div><div class = \"text-block\">Also, here we also need to align the full length of the sequences. Before we were mainly interested in \"local alignment\" where some parts of the sequences may remain un-aligned. Here we are performing \"global alignment\" in that the full sequences will be aligned. <\/div><div class = \"text-block\">For this we will use a tool called Clustal Omega. Let's take a quick look at the help menu:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">clustalo --help<\/span><\/div><div class = \"text-block\">There are lots of different options that you can play around with, so take a look at them. <\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#FFED92"},{"id":689603,"guid":"C0F743F0FC9F11E8B54C97C0DC530A31","previous_id":689602,"previous_guid":"0E33B730FC9F11E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"41E6F7FB95D54C86B25054F32E3E1469","order_id":1,"type_id":6,"title":"Section","source":{"title":"Align the sequences"}},{"id":1054724,"guid":"879E604873E54F86BED772A5D451EE84","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Here we will use a simple clustalo command using mainly default parameters:\n<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">clustalo -i SSU_seqs.fna -o SSU.aln<\/span><\/div><div class = \"text-block\">The -i flag specifies the input, and the -o flag specifies the output. The default output format is \"FASTA\". Let's take a look at what that looks like:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">head SSU.aln<\/span><\/div><div class = \"text-block\">You will notice that the output file looks fairly similar to the input file, but that the sequences have some gaps that are denoted with \"-\" symbols. These gaps are needed since some sequences may have insertions or deletions (\"indels\") that make it impossible to align some regions of one sequence to another. <\/div><div class = \"text-block\">Let's take another look using seqkit:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">seqkit fx2tab -l -n -g  SSU.aln<\/span><\/div><div class = \"text-block\">You will notice here that all of the sequences are the same length now. This should always be the case for aligned sequences, since gaps will be introduced to ensure that every position in one aligned sequence can be related to the same position in another. <\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#E57785"},{"id":689604,"guid":"78BB2E20FCA011E8B54C97C0DC530A31","previous_id":689603,"previous_guid":"C0F743F0FC9F11E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"F3662CCA9B2749A29C8C73615E59D872","order_id":1,"type_id":6,"title":"Section","source":{"title":"Compare different alignment formats"}},{"id":1054724,"guid":"61DB2D1643004F9D91AE9E8B8E3F13EC","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">The default FASTA alignment we got from clustalo is just one of many alignment formats that we can get. Just to look at another, let's try Phylip format. This format used to be quite commonly used, and many programs still use it. <\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">clustalo -i SSU_seqs.fna -o SSU.phy.aln --outfmt=phy<\/span><\/div><div class = \"text-block\">Let's take a look using Unix head:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">head SSU.phy.aln<\/span><\/div><div class = \"text-block\">Whereas the FASTA formatted alignment displayed every sequence in full sequentially, here all aligned regions are displayed together. This is called \"Phylip interleaved\" format, since the aligned sequences are interleaved. Note that names are also truncated to only 10 characters.  <\/div><div class = \"text-block\">Try Clustal format too and see what that looks like:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">clustalo -i SSU_seqs.fna -o SSU.clu.aln --outfmt=clu<\/span><\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">head SSU.clu.aln<\/span><\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#A492FF"},{"id":689605,"guid":"FACBB060FCA011E8B54C97C0DC530A31","previous_id":689604,"previous_guid":"78BB2E20FCA011E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"8FEAFA334FF24B388D8814226F8F781C","order_id":1,"type_id":6,"title":"Section","source":{"title":"Look at the options in FastTree"}},{"id":1054724,"guid":"ED0657AF4DF0472F9B82B2322C4C5679","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Now that we have our multi-sequence alignment file we can create a phylogeny using a program called FastTree. <\/div><div class = \"text-block\">As the name suggests, this program is quite fast. Early phylogenic estimation programs were very computaionally intense and took a very long time to finish (many still are). But there are some new methods like FastTree that speed things up. <\/div><div class = \"text-block\">First let's take a look at the options:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">fasttree<\/span><\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#84CE84"},{"id":689606,"guid":"57EA0990FCA111E8B54C97C0DC530A31","previous_id":689605,"previous_guid":"FACBB060FCA011E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"CB3486C99535467594D4DF7C1277BB77","order_id":1,"type_id":6,"title":"Section","source":{"title":"Create the phylogenetic tree"}},{"id":1054724,"guid":"7D2E450F83F749F0A1672BDABE77A53A","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">To run the program on our alignment we can type:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">fasttree -nt SSU.aln > SSU.nwk<\/span><\/div><div class = \"text-block\">The output in this case is a Newick file, with .nwk extension. This is the most commonly used file format to store phylogenetic trees. The format is quite compact and you will see the file is quite small. Let's take a look:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">ls -la<\/span><\/div><div class = \"text-block\">and <\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">head SSU.nwk<\/span><\/div><div class = \"text-block\">Newick format is a bit hard to read just by looking at it, especially for trees with many species. The general principal is that parentheses are placed to denote evolutionary relationships. So something like  A(B,C) would mean that A and B are more closely related than either is to A. Branch lengths and support values are also in there, so it can get a bit dense.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#EA9F6C"},{"id":689609,"guid":"E0ED6A70FCA111E8B54C97C0DC530A31","previous_id":689606,"previous_guid":"57EA0990FCA111E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"84B72637E7C846DDAA15FC749E3BF512","order_id":1,"type_id":6,"title":"Section","source":{"title":"Visualize the tree in iTOL"}},{"id":1054724,"guid":"E592E6E3D7F544ABBBAE77955246768D","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">To visualize phylogenetic trees I like to use a handy website called iTOL, which stands for \"interactive Tree of Life\". You can find it here:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">itol.embl.de<\/span><\/div><div class = \"text-block\">If you click on the \"upload\" tab on the top you should be taken to a page where you can paste your Newick tree and give it a name. For larger trees you may wish to navigate to upload the .nwk file, but here it may be easiest just to cut-and-paste the test from your Newick file into the itol website and give it a name like \"SSU_test\". <\/div><div class = \"text-block\">Once you do this you will be taken to the iTOL browser where you should see a visual representation of your tree, with the sequence names at the \"leaves\". A menu on the right will allow you to manipulate the tree in different ways. <\/div><div class = \"text-block\">A few things you can do:<\/div><div class = \"text-block\">1) On the main menu under \"basic\" you can increase the width of the branch lines. This makes things easier to see. <\/div><div class = \"text-block\">2) You can go between \"circular\", \"normal\", and \"unrooted\" tree schema in the top of the \"basic\" menu. Check out these different views. Are some easier to interpret?<\/div><div class = \"text-block\">3). In the \"advanced\" meny you can click on \"display\" next to \"bootstraps\/metadata\". The default behavior here is to show circles on each node which have size proportional to the node support values. You can click on \"text\" and play with the font size to see the actual values. These numbers tell us the confidence that FastTree has in the branching order that is presented. Here values are between 0 and 1, with higher values indicating higher support. <\/div><div class = \"text-block\">4) Note that the branch lengths are very long between Nitrososphaera and Sulfolobus and the rest of the tree. That is becuase these two taxa are Archaea, while the rest of the tree contains Bacteria. Archaea and Bacteria are separated by billions of years of evolution, so it is not surprising that their SSU rRNA genes are quite a bit different. In a way it is amazing that we can even align them!<\/div><div class = \"text-block\">Since we know that Archaea and Bacteria have this split we can \"root\" the tree by clicking on the branch above Nitrososphaera and Sulfolobus, navigating down to \"Tree Structure\" in the banner that pops up, and clicking \"Reroot tree here\". You will see the topology of the tree change (and hopefully it will make more evolutioary sense!). <\/div><div class = \"text-block\">Overall iTOL is a great tool for visualizing phylogenies, so spend some time playing around with the different options!<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#E57785"},{"id":721786,"guid":"181CBD80476011E989A3A3AE1D4AB22F","previous_id":689609,"previous_guid":"E0ED6A70FCA111E8B54C97C0DC530A31","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"B0CEA99A45F74A5F9FA0CBAABB73A73D","order_id":1,"type_id":6,"title":"Section","source":{"title":"Visualize the tree in iTOL"}},{"id":1054724,"guid":"AF9F0F50BD98479EB3F4C4240FF82932","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Now let's say we find a new genome and we want to add it into our phylogeny. How do we go about that?<\/div><div class = \"text-block\">Let's start by downloading a genome from NCBI. Let's use Rickettsia prowazekii, the causative agent of Typhys. I browsed the NCBI website and found this link for the genome, which we can download using wget:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">wget -O rickettsia.fna.gz <\/span><\/div><div class = \"text-block\"><a style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">ftp:\/\/ftp.ncbi.nlm.nih.gov\/genomes\/all\/GCF\/000\/195\/735\/GCF_000195735.1_ASM19573v1\/GCF_000195735.1_ASM19573v1_genomic.fna.gz<\/span><\/a><\/div><div class = \"text-block\">and then:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">gunzip rickettsia.fna.gz<\/span><\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":721787,"guid":"625CEB40476011E989A3A3AE1D4AB22F","previous_id":721786,"previous_guid":"181CBD80476011E989A3A3AE1D4AB22F","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"FB3ABBF0F7AF44EEB4B2738D9D82FB18","order_id":1,"type_id":6,"title":"Section","source":{"title":"Visualize the tree in iTOL"}},{"id":1054724,"guid":"EF45A6A127EA481A89C0D83BB6405E35","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Now we need to get the 16S gene(s) from this organisms. We can predict them with barrnap:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">barrnap rickettsia.fna > rickettsia.rrna.gff<\/span><\/div><div class = \"text-block\">We only want the 16S gene, not all the other rRNAs, so we can extract the lines that correspond to 16S genes with grep:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">grep \"16S\" rickettsia.rrna.gff > rick.16S.gff<\/span><\/div><div class = \"text-block\">and we can double check everything looks good:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">more rick.16S.gff<\/span><\/div><div class = \"text-block\">Based on this it looks like there is only one 16S gene. <\/div><div class = \"text-block\">Since barrnap only gives us a gff file, we still need to extract the actual 16S sequences from the genome. We can do this with BedTools:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">bedtools getfasta -s -fi rickettsia.fna -bed rick.16S.gff -fo rick.16S.fna<\/span><\/div><div class = \"text-block\">and to double check the file:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">more rick.16S.fna<\/span><\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":721794,"guid":"F0586C30476011E989A3A3AE1D4AB22F","previous_id":721787,"previous_guid":"625CEB40476011E989A3A3AE1D4AB22F","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"ACAE78BD98FD4303AE4C468C1970456D","order_id":1,"type_id":6,"title":"Section","source":{"title":"Visualize the tree in iTOL"}},{"id":1054724,"guid":"49743D55D8AE4A41A5C928B8DE08DB5A","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">For the phylogeny we need a combined alignment of this new 16S gene together with our references. So first let's combined the sequences:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">cat rick.16S.fna SSU_seqs.fna<\/span><\/div><div class = \"text-block\">And then we can make the alignment and phylogeny just as we did in the steps above:<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">clustalo -i all_16S.fna -o all_16S.aln<\/span><\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">fasttree -nt all_16S.fna > all_16S.nwk<\/span><\/div><div class = \"text-block\">And then visualize with iTOL as we did above. Rickettsia is an Alphaproteobacteria, so you should see it clustering with the Pelagibacter in the tree. <\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null}],"materials":[],"description":"<div class = \"text-blocks\"><\/div>","changed_on":1552771819}