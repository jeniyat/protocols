{"uri":"creating-blast-app-for-cyverse-g2ybyfw","version_id":"0","protocol_name":"Creating BLAST app for Cyverse","protocol_name_html":"Creating BLAST app for Cyverse","is_prepublished":"0","can_edit":"0","parent_id":null,"api_version":"1","is_new_mode":"1","last_modified":"1521007861","type_id":"1","link":"","fork_id":"","public_fork_note":"","number_of_steps":"11","has_versions":"1","first_published_date":"1485385882","publish_date":"2017-01-25 23:11:22","documents":null,"have_protocol_in_step":"0","is_protocol_in_step":"0","vendor_name":"Contributed by users","vendor_link":"https:\/\/www.protocols.io","vendor_logo":"\/img\/vendors\/1.png","mod_mins":"-45","mod_secs":"1","description":"<p>How I created a BLAST app for Cyverse.<\/p>","is_bookmarked":"0","can_reassign":"1","before_start":"","has_guidelines":"0","materials":[],"warning":"","version_class":"4920","public":"1","is_owner":"1","is_original_owner":"1","created_on":"1485365967","protocol_affiliation":"","affiliation":"University of Arizona","doi":"dx.doi.org\/10.17504\/protocols.io.g2ybyfw","doi_status":"2","changed_fork_steps":null,"profile_url":"Ken-w2u26413","protocol_img":"https:\/\/s3.amazonaws.com\/pr-journal\/hxyi6d.png","profile_image":"https:\/\/s3.amazonaws.com\/pr-journal\/caii6d.png","full_name":"Ken Youens-Clark","created_by":"Ken Youens-Clark","private_link":"C4ABD877728E6F6A48C2F30FB7CCA8BD","original_img":"1","username":"ken-youensclark","is_retracted":"0","retraction_reason":null,"plos_id":null,"manuscript_citation":null,"journal_name":null,"is_donations_disabled":"0","is_donations_disabled_by_user":"9","item_record_id":207413,"fork_info":[],"compare_forks":[],"protocols":[],"groups":[{"group_id":"52","group_uri":"hurwitz-lab","group_name":"Hurwitz Lab","group_logo":"https:\/\/s3.amazonaws.com\/pr-journal\/iscwwe.png","requested_uid":null,"request_flag":null,"my_request":"1"}],"number_of_shared_runs":[],"ownership_history":[],"keywords":"","transfer_to_user":[],"sub_transfer":false,"is_transfer_pending":false,"number_of_bookmarks":"0","collections":[],"tags":[],"archived":0,"sub_authors":[],"sub_protocols_number":0,"can_edit_shared":0,"shared_runs":[],"is_shared_run":0,"is_shared":1,"banner":null,"contact_badges":[{"badge_id":"4","badge_image":"\/img\/badges\/gold.svg","badge_description":"Gold power author!"},{"badge_id":"5","badge_image":"\/img\/badges\/earlyadopter.svg","badge_description":"Early adopter"},{"badge_id":"6","badge_image":"\/img\/badges\/socialbutterfly.svg","badge_description":"Social butterfly"}],"number_of_comments":0,"big_protocol_img":"https:\/\/s3.amazonaws.com\/pr-journal\/hxxi6d.png","big_protocol_img_ofn":"blast_zpsa80ef9af.png","is_locked":0,"is_locked_by":false,"authors":"","authors_list":[],"user":{"profile_image":"https:\/\/s3.amazonaws.com\/pr-journal\/caii6d.png","username":"ken-youensclark","full_name":"Ken Youens-Clark","created_by":"Ken Youens-Clark"},"access":{"can_view":"1","can_remove":"0","can_add":"0","can_edit":0,"can_publish":0,"can_get_doi":0,"can_share":"0","can_move":"1","can_transfer":"1","can_download":"1","is_locked":"0"},"is_contact_suspended":0,"guidelines":"","status_id":"1","is_research":"1","status_info":null,"steps":[{"id":"282107","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"48FB2F8912F94409B675EE4B603DF22E","previous_guid":null,"previous_id":"0","last_modified":"1485380647","components":[{"component_id":"403538","previous_id":0,"original_id":"0","guid":"9CE533E8028F41088FF9A55EF1B05192","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>I created\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast to hold the code for the Stampede\/Cyverse app. \u00a0<\/p>\n<p>\u00a0<\/p>\n<p>Stampede apps are recommended (http:\/\/developer.agaveapi.co\/) to have a 'stampede' directory for the code -- perhaps a different dir for each execution system?<\/p>\n<p>\u00a0<\/p>\n<p>I also created\u00a0https:\/\/github.com\/hurwitzlab\/ohana for the code to build the BLAST dbs and such.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>I created\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast to hold the code for the Stampede\/Cyverse app. \u00a0<\/p>\n<p>\u00a0<\/p>\n<p>Stampede apps are recommended (http:\/\/developer.agaveapi.co\/) to have a 'stampede' directory for the code -- perhaps a different dir for each execution system?<\/p>\n<p>\u00a0<\/p>\n<p>I also created\u00a0https:\/\/github.com\/hurwitzlab\/ohana for the code to build the BLAST dbs and such.<\/p>"},"is_project":0},{"component_id":"403535","previous_id":"403538","original_id":"0","guid":"51B2D8C86D034EA887DDD56FF1E423F9","previous_guid":"9CE533E8028F41088FF9A55EF1B05192","component_type_id":"6","data_id":"0","data":"Create Github repo","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Create Github repo"},"is_project":0}]},{"id":"282353","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"8F758036BDC84E5C86B17C4B782CCA8A","previous_guid":"E250B26267264EC1A2F428A57265099B","previous_id":"282472","last_modified":"1485383137","components":[{"component_id":"403629","previous_id":0,"original_id":"0","guid":"13690EE9E72C47389AF8907CFC48D411","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>This can be any language or executable, but I tend to write these in bash. \u00a0I often call mine 'run.sh' (https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/run.sh) and base it off a template (https:\/\/github.com\/kyclark\/metagenomics-book\/blob\/master\/bash\/basic.sh) that accepts named arguments. \u00a0This script will query\u00a0the input file(s) to the BLAST dbs and then use any resulting hits to predicted genes to query SQLite for annotations which will be placed into an additional file.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>This can be any language or executable, but I tend to write these in bash. \u00a0I often call mine 'run.sh' (https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/run.sh) and base it off a template (https:\/\/github.com\/kyclark\/metagenomics-book\/blob\/master\/bash\/basic.sh) that accepts named arguments. \u00a0This script will query\u00a0the input file(s) to the BLAST dbs and then use any resulting hits to predicted genes to query SQLite for annotations which will be placed into an additional file.<\/p>"},"is_project":0},{"component_id":"403624","previous_id":"403629","original_id":"0","guid":"D61E69B6941943888A665DE14EE7D647","previous_guid":"13690EE9E72C47389AF8907CFC48D411","component_type_id":"6","data_id":"0","data":"Create entry script","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Create entry script"},"is_project":0}]},{"id":"282405","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"B88DE619A7FC4D1DA431A2BF0758370C","previous_guid":"48FB2F8912F94409B675EE4B603DF22E","previous_id":"282107","last_modified":"1485382302","components":[{"component_id":"403793","previous_id":0,"original_id":"0","guid":"C7B02E65DF6E47778540D520466E36DE","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>I pulled down the HOT from Cyverse Data Store at \/iplant\/home\/scope\/data\/delong\/HOT224-238.<\/p>\n<p>\u00a0<\/p>\n<p>To ensure I had everything, I ran\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/check-md5.pl6 to check against MD5 sums.<\/p>\n<p>\u00a0<\/p>\n<p>I wrote\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/mk-blast.sh to concatenate all contigs\/genes\/proteins files into one per type, then index with BLAST.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>I pulled down the HOT from Cyverse Data Store at \/iplant\/home\/scope\/data\/delong\/HOT224-238.<\/p>\n<p>\u00a0<\/p>\n<p>To ensure I had everything, I ran\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/check-md5.pl6 to check against MD5 sums.<\/p>\n<p>\u00a0<\/p>\n<p>I wrote\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/mk-blast.sh to concatenate all contigs\/genes\/proteins files into one per type, then index with BLAST.<\/p>"},"is_project":0},{"component_id":"403723","previous_id":"403793","original_id":"0","guid":"0CC66196FBFB4E79A68D8855D922274A","previous_guid":"C7B02E65DF6E47778540D520466E36DE","component_type_id":"6","data_id":"0","data":"Create the BLAST dbs","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Create the BLAST dbs"},"is_project":0}]},{"id":"282472","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"E250B26267264EC1A2F428A57265099B","previous_guid":"B88DE619A7FC4D1DA431A2BF0758370C","previous_id":"282405","last_modified":"1485382178","components":[{"component_id":"403860","previous_id":0,"original_id":"0","guid":"B2084E7048B846D2B018EE103929D598","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>The original Eggnog annotations to the predicted genes were delivered in a format that spread one annotation over two lines, so I wrote\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/merge-genes.pl6 to merge them. As there were 15M annotations, I struggled over how to store and retrieve them. \u00a0I wanted a database like MySQL or Pg, but it's unlikely I could bring up a daemon-based server on stampede, so I chose SQLite. \u00a0Problem there is I was quite certain it would be too slow to put 15M in one table, so I decided to make a db for each sample (103 of them). \u00a0The script\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/pyloader.py will load the dbs.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>The original Eggnog annotations to the predicted genes were delivered in a format that spread one annotation over two lines, so I wrote\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/merge-genes.pl6 to merge them. As there were 15M annotations, I struggled over how to store and retrieve them. \u00a0I wanted a database like MySQL or Pg, but it's unlikely I could bring up a daemon-based server on stampede, so I chose SQLite. \u00a0Problem there is I was quite certain it would be too slow to put 15M in one table, so I decided to make a db for each sample (103 of them). \u00a0The script\u00a0https:\/\/github.com\/hurwitzlab\/ohana\/blob\/master\/scripts\/pyloader.py will load the dbs.<\/p>"},"is_project":0},{"component_id":"403849","previous_id":"403860","original_id":"0","guid":"BECBF85883FC4103B3BA3CB269259FC4","previous_guid":"B2084E7048B846D2B018EE103929D598","component_type_id":"6","data_id":"0","data":"Load Eggnog annotation dbs","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Load Eggnog annotation dbs"},"is_project":0}]},{"id":"282702","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"BF68A4745C0042559B6CEC97966FFD85","previous_guid":"C0AF6A55031B4E55BB7072B77E579A7D","previous_id":"282710","last_modified":"1485383510","components":[{"component_id":"404364","previous_id":0,"original_id":"0","guid":"52F6A2D2951344C58733E8DC1B1DCD6F","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>The\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/app.json file describes the app to Agave so it can be registered. \u00a0It's most important to define the 'inputs' and 'parameters' with argument names that you will reference via environmental variables in the 'template.sh' script.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>The\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/app.json file describes the app to Agave so it can be registered. \u00a0It's most important to define the 'inputs' and 'parameters' with argument names that you will reference via environmental variables in the 'template.sh' script.<\/p>"},"is_project":0},{"component_id":"404298","previous_id":"404364","original_id":"0","guid":"AD980F0AA3B24036B94901CFEECE83C4","previous_guid":"52F6A2D2951344C58733E8DC1B1DCD6F","component_type_id":"6","data_id":"0","data":"Create \"app.json\"","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Create \"app.json\""},"is_project":0}]},{"id":"282710","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"C0AF6A55031B4E55BB7072B77E579A7D","previous_guid":"8F758036BDC84E5C86B17C4B782CCA8A","previous_id":"282353","last_modified":"1485383227","components":[{"component_id":"404311","previous_id":0,"original_id":"0","guid":"732485A83D524DE3B6C23F84D1084EC5","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>The\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/test.sh is for testing that the app is able to be submitted (via \"sbatch\") to SLURM and will run.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>The\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/test.sh is for testing that the app is able to be submitted (via \"sbatch\") to SLURM and will run.<\/p>"},"is_project":0},{"component_id":"404306","previous_id":"404311","original_id":"0","guid":"FDC7C91678924B1A8466360A81FBA085","previous_guid":"732485A83D524DE3B6C23F84D1084EC5","component_type_id":"6","data_id":"0","data":"Create \"test.sh\"","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Create \"test.sh\""},"is_project":0}]},{"id":"282801","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"9584136BF66C40208DCFB1305EE93AF3","previous_guid":"BF68A4745C0042559B6CEC97966FFD85","previous_id":"282702","last_modified":"1485383554","components":[{"component_id":"404482","previous_id":0,"original_id":"0","guid":"C1356A00D0A846BD8995BBA085400305","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>The\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/template.sh script will take the arguments from Cyverse as environmental variables defined in your \"app.json\"'s inputs\/parameters. \u00a0I usually just have this pass the arguments to \"run.sh\".<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>The\u00a0https:\/\/github.com\/hurwitzlab\/muscope-blast\/blob\/master\/stampede\/template.sh script will take the arguments from Cyverse as environmental variables defined in your \"app.json\"'s inputs\/parameters. \u00a0I usually just have this pass the arguments to \"run.sh\".<\/p>"},"is_project":0},{"component_id":"404480","previous_id":"404482","original_id":"0","guid":"17F82B85515045D78142CA0052C20789","previous_guid":"C1356A00D0A846BD8995BBA085400305","component_type_id":"6","data_id":"0","data":"Create \"template.sh\"","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Create \"template.sh\""},"is_project":0}]},{"id":"282866","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"D43DCB691ED94430BF9A54B1FD1BDAA5","previous_guid":"9584136BF66C40208DCFB1305EE93AF3","previous_id":"282801","last_modified":"1485383602","components":[{"component_id":"404610","previous_id":0,"original_id":"0","guid":"0A1196D92B354942A8F3E4D3301A315C","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>Run \"apps-addupdate -F app.json\" to register the app with Agave.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>Run \"apps-addupdate -F app.json\" to register the app with Agave.<\/p>"},"is_project":0},{"component_id":"404604","previous_id":"404610","original_id":"0","guid":"273E5F885E7F4A499E92183DA7FB227E","previous_guid":"0A1196D92B354942A8F3E4D3301A315C","component_type_id":"6","data_id":"0","data":"Register the app with \"apps-addupdate\"","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Register the app with \"apps-addupdate\""},"is_project":0}]},{"id":"282890","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"C649CA32823140D7AFAA994939033ABB","previous_guid":"D43DCB691ED94430BF9A54B1FD1BDAA5","previous_id":"282866","last_modified":"1485384698","components":[{"component_id":"404655","previous_id":0,"original_id":"0","guid":"64B1415BB397480E8CD6B77931ABDC7B","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>Run \"jobs-template $APP &gt; job.json\" (e.g, just run \"make jobs-template\") to generate a JSON template for submitting the job via the Agave API.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>Run \"jobs-template $APP &gt; job.json\" (e.g, just run \"make jobs-template\") to generate a JSON template for submitting the job via the Agave API.<\/p>"},"is_project":0},{"component_id":"404646","previous_id":"404655","original_id":"0","guid":"81745D190CBE40D5A02945735984F4F8","previous_guid":"64B1415BB397480E8CD6B77931ABDC7B","component_type_id":"6","data_id":"0","data":"Create \"job.json\"","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Create \"job.json\""},"is_project":0}]},{"id":"282935","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"4F4DE787864E4BF982E960C5F883D1C8","previous_guid":"C649CA32823140D7AFAA994939033ABB","previous_id":"282890","last_modified":"1485385439","components":[{"component_id":"404729","previous_id":0,"original_id":"0","guid":"47ABB07078BE4DB68962B84EDECD568A","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>Use 'jobs-submit -F job.json' (or 'make jobs-submit') to test if it will submit. \u00a0Use 'jobs-list | head' to see the status. \u00a0Your job will be the top one and will start off like 'PENDING' and then 'STAGING,' 'QUEUED,' 'RUNNING,' and then 'FAILED' or 'FINISHED.' \u00a0Using the job ID (e.g., '5905387002803589606-242ac114-0001-007') with 'jobs-status' and 'jobs-history,' you can find out more about what it is doing, possibly where it is failing. \u00a0When it is done, you can use 'jobs-output' to see what was created.<\/p>\n<p>\u00a0<\/p>\n<p>The results will land in your \"$WORK\/&lt;userid&gt;\/job-&lt;jobid&gt;-&lt;jobname&gt;\" directory.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>Use 'jobs-submit -F job.json' (or 'make jobs-submit') to test if it will submit. \u00a0Use 'jobs-list | head' to see the status. \u00a0Your job will be the top one and will start off like 'PENDING' and then 'STAGING,' 'QUEUED,' 'RUNNING,' and then 'FAILED' or 'FINISHED.' \u00a0Using the job ID (e.g., '5905387002803589606-242ac114-0001-007') with 'jobs-status' and 'jobs-history,' you can find out more about what it is doing, possibly where it is failing. \u00a0When it is done, you can use 'jobs-output' to see what was created.<\/p>\n<p>\u00a0<\/p>\n<p>The results will land in your \"$WORK\/&lt;userid&gt;\/job-&lt;jobid&gt;-&lt;jobname&gt;\" directory.<\/p>"},"is_project":0},{"component_id":"404727","previous_id":"404729","original_id":"0","guid":"E996CF76441B4D1A810E8F2389B6C26C","previous_guid":"47ABB07078BE4DB68962B84EDECD568A","component_type_id":"6","data_id":"0","data":"Submit \"job.json\"","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Submit \"job.json\""},"is_project":0}]},{"id":"283054","is_changed":"0","original_id":"0","is_skipped":"0","is_checked":"0","guid":"8E1F367D74B74BAD80EBB7C3E1B0CAB4","previous_guid":"4F4DE787864E4BF982E960C5F883D1C8","previous_id":"282935","last_modified":"1485385490","components":[{"component_id":"404964","previous_id":0,"original_id":"0","guid":"2CB9D28314E242919EF037FA4335EB80","previous_guid":null,"component_type_id":"1","data_id":"0","data":"<p>Use\u00a0https:\/\/de.cyverse.org\/de\/ to find the job and submit there.<\/p>","order_id":"0","name":"Description","data_by_id":"0","type_id":"1","source_data":{"description":"<p>Use\u00a0https:\/\/de.cyverse.org\/de\/ to find the job and submit there.<\/p>"},"is_project":0},{"component_id":"404963","previous_id":"404964","original_id":"0","guid":"A1E216533CFC4E9C84F781A7838FD4A5","previous_guid":"2CB9D28314E242919EF037FA4335EB80","component_type_id":"6","data_id":"0","data":"Submit job via DE","order_id":"1","name":"Section","data_by_id":"0","type_id":"6","source_data":{"section":"Submit job via DE"},"is_project":0}]}]}