{"id":19365,"title":"Bioinformatic pipeline for studying transcriptome and regulome dynamics during neural differentiation","title_html":"Bioinformatic pipeline for studying transcriptome and regulome dynamics during neural differentiation","image":{"source":"https:\/\/www.protocols.io\/img\/default_protocol.png","placeholder":"https:\/\/www.protocols.io\/img\/default_protocol.png"},"doi":"dx.doi.org\/10.17504\/protocols.io.w6dfha6","doi_status":2,"uri":"bioinformatic-pipeline-for-studying-transcriptome-w6dfha6","type_id":1,"published_on":1547603743,"version_id":4,"created_on":1547602346,"categories":null,"creator":{"name":"wang shengpeng","affiliation":"","username":"wang-shengpeng","link":null,"image":{"source":"\/img\/avatars\/011.png","placeholder":"\/img\/avatars\/011.png"},"badges":[{"id":2,"image":{"source":"\/img\/badges\/bronze.svg","placeholder":"\/img\/badges\/bronze.svg"},"name":"Author"}],"research_interests":null},"journal":null,"journal_name":null,"journal_link":null,"public":1,"has_versions":1,"link":null,"number_of_steps":12,"authors":[{"name":"Zhouchun Shang","affiliation":"BGI-shenzhen, Shenzhen, China","username":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"research_interests":null},{"name":"Dongsheng Chen","affiliation":"BGI-shenzhen, Shenzhen, China","username":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"research_interests":null},{"name":"Quanlei Wang","affiliation":"BGI-shenzhen, Shenzhen, China","username":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"research_interests":null},{"name":"Shengpeng Wang","affiliation":"BGI-shenzhen, Shenzhen, China","username":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"research_interests":null}],"versions":[],"groups":[],"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"forks_count":{"private":0,"public":0},"steps":[{"id":698197,"guid":"A9A103B157094FD4B02CF2D02B0F68A2","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"E50A94ABF77D4B8580D4FE96BF40254E","order_id":1,"type_id":6,"title":"Section","source":{"title":"Raw data description"}},{"id":1054723,"guid":"265A96DF5D384506B7318CD9D1608166","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Single cell RNA-seq: 50bp single-end sequencing was performed using the BGISEQ-500 platform<\/div><div class = \"text-block\">Bulk RNA-seq: 50bp single-end sequencing was performed using the BGISEQ-500 platform<\/div><div class = \"text-block\">Assay for Transposase-Accessible Chromatin using sequencing (ATAC-seq) was sequenced on BGISEQ-500 platform<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698198,"guid":"99166888C5364CD1A8D1D84231865060","previous_id":698197,"previous_guid":"A9A103B157094FD4B02CF2D02B0F68A2","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"72F64919306042B18AFC4F8348561BFB","order_id":1,"type_id":6,"title":"Section","source":{"title":"Assess read qualities of read files (fastq files) using FASTQC"}},{"id":1054723,"guid":"169FF1FCFF7B4573B70389B157826382","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">FASTQC<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698199,"guid":"0AB914306C2C4BC1AC3D31BE82E6A63F","previous_id":698198,"previous_guid":"99166888C5364CD1A8D1D84231865060","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"52FF702C5B034FD7AF3AF139111C7FD6","order_id":1,"type_id":6,"title":"Section","source":{"title":"Pre-processing of raw data"}},{"id":1054723,"guid":"DAD9594C6C0F4E8B92A97E3F48485920","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">The original FASTQ data of the 527 samples were aligned to the rRNA database (downloaded from NCBI) to remove rRNAs and the remaining reads were processed with SOAPnuke (version 1.5.3) to trim adaptors and filter out the low-quality reads. The filtered data were aligned to the reference genome (hg19) using hisat2 (HISAT2 version 2.0.1-beta). Reads were counted using the R package GenomicAlignments (mode='Union', inter.feature=FALSE), and normalized to RPKM with edgeR.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698200,"guid":"032E67F9D53E4940BB6C315806A4CA3A","previous_id":698199,"previous_guid":"0AB914306C2C4BC1AC3D31BE82E6A63F","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"34E157AA27AC48488FAB408FD5574129","order_id":1,"type_id":6,"title":"Section","source":{"title":"Quality control of single cell RNA-seq"}},{"id":1054723,"guid":"B9840C0CF13D4CEA87C3D7E4FE9EEAE5","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Cells were filtered using following parameters: genome mapping rate more than 70%, fraction of reads mapped to mitochondrial genes less than 20%, mRNA mapping rate more than 80%, ERCC ratio less than 10%, and gene number more than 5000. Further, correlation of ERCC among cells was used to evaluate the quality of each cell (threshold=0.9). At last, 445 single cells remained for further analysis in this project.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698201,"guid":"9B3B91C6CC9041EB93569604C8E23A7B","previous_id":698200,"previous_guid":"032E67F9D53E4940BB6C315806A4CA3A","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"93B406FBFD9847ADB55104F6F8C3954F","order_id":1,"type_id":6,"title":"Section","source":{"title":"Identification of differentially expressed genes"}},{"id":1054723,"guid":"FDBBBA0B1D364F0784E07700FAB5E53D","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Differentially expressed genes\u00a0 in iPSCs, EB, Ros-E, Ros-L, and NPCs was determined using SCDE (single cell differential expression analysis) with default parameters except requiring a minimum of 100 genes (parameter min.lib.size = 100 to call scde.error. models function). The Z scores and corrected Z scores (cZ) to adjust for the multiple testing were converted into two-tailed p-values and adjusted to control for FDR using pnorm function in R. The significantly differentially expressed genes were selected based on following criteria: adjusted p-value < 0.01 and fold-change > 2.<\/div><div class = \"text-block\">##################Detailed script in this step####################<\/div><div class = \"text-block\">da = read.table('expression_matrix.txt',header=T,row.names=1,check.names=FALSE,sep='\\t')<\/div><div class = \"text-block\">####do Differential Expression\nlibrary(methods)\nlibrary(scde)\nEB=da[,grep('EB',colnames(da))]\nall=da[,c(-grep('EB',colnames(da)),-grep('Fib',colnames(da)))]\nx = cbind(EB,all)\nsg1 <- gsub('(b[0-9]+).(EB|all)*', '\\\\2', colnames(x))\nsg <- factor(gsub('(EB|all).*', '\\\\1', sg1), levels = c('EB', 'all'))\nsg[is.na(sg)] = 'all'\nnames(sg) <- colnames(x)\ntable(sg)\u00a0\ncd <- clean.counts(x, min.lib.size=100, min.reads = 1, min.detected = 1)\no.ifm <- scde.error.models(counts = cd, groups = sg, n.cores = 1, threshold.segmentation = TRUE, save.crossfit.plots = FALSE, save.model.plots = FALSE, verbose = 1)<\/div><div class = \"text-block\">save(o.ifm,file='EB_VS_all.scde.error.models.RData')\n#load('EB_VS_all.scde.error.models.RData')<\/div><div class = \"text-block\">valid.cells <- o.ifm$corr.a > 0\ntable(valid.cells)\no.ifm <- o.ifm[valid.cells, ]\no.prior <- scde.expression.prior(models = o.ifm, counts = cd, length.out = 400, show.plot = FALSE)<\/div><div class = \"text-block\">group1 <- gsub('(b[0-9]+).(EB|all)*', '\\\\2', rownames(o.ifm))\ngroup <- factor(gsub('(EB|all).*', '\\\\1', group1), levels = c('EB', 'all'))\ngroup[is.na(group)] = 'all'\nnames(group) <- row.names(o.ifm)\nediff <- scde.expression.difference(o.ifm, cd, o.prior, groups = group, n.randomizations = 100, n.cores = 1, verbose = 1)<\/div><div class = \"text-block\">p.values <- 2*pnorm(abs(ediff$Z),lower.tail=F) # 2-tailed p-value\np.values.adj <- 2*pnorm(abs(ediff$cZ),lower.tail=F) # Adjusted to control for FDR\nsignificant.genes <- which(p.values.adj<0.05)\nlength(significant.genes)\nord <- order(p.values.adj[significant.genes]) # order by p-value\nde <- cbind(ediff[significant.genes,1:3],p.values.adj[significant.genes])[ord,]\ncolnames(de) <- c('Lower bound','log2 fold change','Upper bound','p-value')\nwrite.table(de, file = 'EB_VS_all.scde.FDR.xls', row.names = TRUE, col.names = TRUE, sep = '\\t', quote = FALSE)<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698202,"guid":"31CF7C4A513C451F8D83FD403ACFF659","previous_id":698201,"previous_guid":"9B3B91C6CC9041EB93569604C8E23A7B","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"F52988DE71DE4EF9B1D93CB7CD87E2D8","order_id":1,"type_id":6,"title":"Section","source":{"title":"Constructing trajectory using variable genes"}},{"id":1054723,"guid":"E609A19FD6C441B7BA2F484F7C129502","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Monocle ordering was conducted for all iPSCs, EB, Ros-E, Ros-L and NPCs cells using the set of variable genes with default parameters except we specified reduction_method =\u201dDDRTree\u201d in the reduceDimension function. The variable genes were selected using the Seurat R package.<\/div><div class = \"text-block\">##################Detailed script in this step####################<\/div><div class = \"text-block\">myda\u00a0= read.table('expression_matrix.txt',sep='\\t',header = T,row.names = 1)<\/div><div class = \"text-block\">exp = subset(exp,select=c(-grep('H9|Fib',colnames(exp))))<\/div><div class = \"text-block\">library(Seurat)\nmarrow <- CreateSeuratObject(raw.data = myda)\nmarrow <- NormalizeData(object = marrow)\nmarrow <- FindVariableGenes(object = marrow,\nmean.function = ExpMean,\ndispersion.function = LogVMR,\nx.low.cutoff = 0, x.high.cutoff = 100,\ny.cutoff = 0.5,\ndo.plot = TRUE)\ndim(x = marrow@var.genes)<\/div><div class = \"text-block\">myda = myda[as.matrix(marrow@var.genes),]<\/div><div class = \"text-block\">pheno.data1 <- colnames(myda)\npheno.data2 <- unlist(lapply(pheno.data1, function(x) strsplit(x,'.',fixed = TRUE)[[1]][2]))\npheno.data3 <- unlist(lapply(pheno.data2, function(x) strsplit(x,'_',fixed = TRUE)[[1]][1])) ##remove the quantity id for each samples\npheno.data4 <- unlist(lapply(pheno.data1, function(x) strsplit(x,'_',fixed = TRUE)[[1]][1]))\npheno.data5 <- unlist(lapply(pheno.data4, function(x) strsplit(x,'.',fixed = TRUE)[[1]][1]))<\/div><div class = \"text-block\">mode(pheno.data5)\npheno.data.df <- data.frame(type=pheno.data3)\nrownames(pheno.data.df) <- colnames(myda)\npd <- new('AnnotatedDataFrame', data = pheno.data.df)<\/div><div class = \"text-block\">\nfeature.fd = rownames(myda)\nfeature.fd <- unlist(lapply(feature.fd, function(x) strsplit(x, '.')[[1]][1]))\nfeature.data.fd = data.frame(type=feature.fd)\nrownames(feature.data.fd) <- rownames(myda)\nfd <- new('AnnotatedDataFrame', data = feature.data.fd)<\/div><div class = \"text-block\">HSMM <- newCellDataSet(as(as.matrix(myda), 'sparseMatrix'),\nphenoData = pd,\nfeatureData = fd,\nlowerDetectionLimit=1,\nexpressionFamily=tobit())<\/div><div class = \"text-block\">ordering.genes <- rownames(feature.data.fd)\ndata <- setOrderingFilter(HSMM, ordering.genes)\ndata <- reduceDimension(data,max_components=2,reduction_method = c('DDRTree'),norm_method = 'none')\ndata <- orderCells(data, num_paths = 2, reverse = FALSE)\nsave(data,file='monocle_simple_used_391sample.gene.RData')<\/div><div class = \"text-block\">pdf('monocle_simple_used__main_subtype.gene_subtype.pdf')<\/div><div class = \"text-block\">plot_cell_trajectory(data, color_by = 'type',show_branch_points = FALSE)<\/div><div class = \"text-block\">dev.off()<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698203,"guid":"A2FEC50E12E1435CA4BE49A7218B0CA0","previous_id":698202,"previous_guid":"31CF7C4A513C451F8D83FD403ACFF659","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"A6BF325F6B2140BE973ADE7DCA47C324","order_id":1,"type_id":6,"title":"Section","source":{"title":"Analysis of heterogeneity in each cell stage"}},{"id":1054723,"guid":"D834001EDF5B461EB08CFB92D24807FA","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">The heterogeneity of each cell stage was determined using Seurat R package.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698204,"guid":"A416A39502844C30A165F58B38F25376","previous_id":698203,"previous_guid":"A2FEC50E12E1435CA4BE49A7218B0CA0","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"0FB448BFC8274E8DBC10036EF4C0B885","order_id":1,"type_id":6,"title":"Section","source":{"title":"ATAC peak calling"}},{"id":1054723,"guid":"A0A21978656046BC9B3CCB337E773754","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">We aligned ATAC-seq data to hg19 using Bowtie2 and called peaks using MACS2. We established a standard peak set by merging all overlapping peaks. The IDR pipeline was used to identify reproducible peaks between two biological replicates. Only peaks with IDR<0.01 were considered reproducible and retained for downstream analysis. Pearson correlation coefficients of two biological replicates at each stage were calculated. Stage-specific peaks were defined as peaks having no overlap with any peaks in other stages. Novel peaks were defined as peaks non-overlapping with previous stages. In the case of iPSCs, all peaks were annotated as novel peaks.\u00a0<\/div><div class = \"text-block\">For reproducible peaks, we applied HOMER to assign putative targets for peaks. For stage-specific peaks, ChIPseeker was used for putative target assignment. In both strategies, the putative target of a certain peak is defined as the gene with TSS closest to the peak summit location.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698205,"guid":"625F6004117D4FFF910F3F4CAEC3D442","previous_id":698204,"previous_guid":"A416A39502844C30A165F58B38F25376","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"5E27243D83504748A3A1950AA01CFCE7","order_id":1,"type_id":6,"title":"Section","source":{"title":"GO term and KEGG pathway enrichment analysis"}},{"id":1054723,"guid":"9762E9ACAE07424EA8F1BB59D0B7A200","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Lists of genes were analysed using DAVID and the BH method was used for multiple test correction. GO terms with a FDR less than 0.01 or 0.05 were considered as significantly enriched. Target genes of stage-specific ATAC peaks were analysed using the R package, clusterProfiler, in which an adjusted p-value of 0.05 was used to identify significantly enriched GO and KEGG terms associated with each set of peaks.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698206,"guid":"686C811A9D3543CDAAEB1CB7E2EECEB6","previous_id":698205,"previous_guid":"625F6004117D4FFF910F3F4CAEC3D442","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"B1990681039A4C2FA0CD2B297A5E0BDD","order_id":1,"type_id":6,"title":"Section","source":{"title":"Regulatory network construction"}},{"id":1054723,"guid":"37BB79CC697D4FD399CDE226B451931A","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">The scRNA-seq profiles among each cell types were compared using SCDE package. TFs significantly differentially expressed, with adjusted p-value threshold of 0.05, among neighboring cell types were submitted to STRING database to infer regulatory networks based on known interaction relationships (supported by data from curated databases, experiments and text-mining). TFs without any interactions with other proteins were removed from the network. To select key regulators, we used a threshold of 5 and all TFs with number of interactions above the threshold were considered as key regulators.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698207,"guid":"DE5D91F9E6BD4F23B3BD6448C5CD0855","previous_id":698206,"previous_guid":"686C811A9D3543CDAAEB1CB7E2EECEB6","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"2DD0C25E6CE444758D1DF12529AB524D","order_id":1,"type_id":6,"title":"Section","source":{"title":"Construction of cellular communication network"}},{"id":1054723,"guid":"FBF0B13C143B4766BA663BBC9B3FB5BD","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">The ligand-receptor interaction relationships were downloaded from the database, IUPHAR\/BPS Guide to PHARMACOLOGY, and the Database of Ligand-Receptor Partners (DLRP). The average expression level of RPKM of 1 was used as a threshold. Ligands and receptors above the threshold were considered as expressed in the corresponding cluster. The R package Circlize was used to visualize the interactions.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null},{"id":698208,"guid":"007B3BB159C349F1B0B889BB1DE620A5","previous_id":698207,"previous_guid":"DE5D91F9E6BD4F23B3BD6448C5CD0855","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"03785B4619D046B8BAF5C5FA3003A981","order_id":1,"type_id":6,"title":"Section","source":{"title":"Motif enrichment analysis"}},{"id":1054723,"guid":"9AF9EA1D8CFE4B239299F35E7F9C8947","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Motifs enriched in each set of ATAC peaks were identified using findMotifsGenome.pl from HOMER using following parameters: -size -100,100 -len 4,5,6,7,8,9,10,11,12.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null}],"materials":[],"description":"<div class = \"text-blocks\"><div class = \"text-block\">Here we present a bioinformatic pipeline for dissecting transcriptional regulation of neural differentiation process. Single cell RNA-seq and bulk ATAC-seq with two biological replicates was applied to the indicated cell stages including human induced pluripotent stem cells (hiPSCs), embryoid body (EB), early rosettes (Ros-E), late rosettes (Ros-L), neural progenitor cells (NPCs), and the original somatic fibroblasts (Fib) for a deeper understanding of the regulatory mechanisms driving the differentiation of the neural lineage. This pipeline could be applied to study transcriptome and regulome dynamics of other lineages.<\/div><\/div>","changed_on":1547603743}