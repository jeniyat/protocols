{"id":26459,"title":"Demultiplexing Nanopore reads with LAST","title_html":"Demultiplexing Nanopore reads with LAST","image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/bcixa.png","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/bcixa.png"},"doi":"dx.doi.org\/10.17504\/protocols.io.533g8qn","doi_status":2,"uri":"demultiplexing-nanopore-reads-with-last-533g8qn","type_id":1,"published_on":1564748139,"parent_protocols":[],"parent_collections":[],"version_id":3,"created_on":1564747325,"categories":null,"creator":{"name":"David A. Eccles","affiliation":"Malaghan Institute of Medical Research (NZ)","affiliations":[{"affiliation":"Malaghan Institute of Medical Research (NZ)","url":"http:\/\/www.malaghan.org.nz\/","is_default":1}],"username":"david-eccles","link":"https:\/\/doi.org\/10.5281\/zenodo.2535894","image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg"},"badges":[{"id":3,"image":{"source":"\/img\/badges\/silver.svg","placeholder":"\/img\/badges\/silver.svg"},"name":"Power author!"},{"id":6,"image":{"source":"\/img\/badges\/socialbutterfly.svg","placeholder":"\/img\/badges\/socialbutterfly.svg"},"name":"Social butterfly"}],"research_interests":null,"blocked_by_you":false,"blocked_you":false},"journal":null,"journal_name":null,"journal_link":null,"article_citation":null,"public":1,"has_versions":1,"link":"https:\/\/doi.org\/10.5281\/zenodo.2535894","total_collections":0,"number_of_steps":5,"authors":[{"name":"David Eccles","affiliation":"Malaghan Institute of Medical Research (NZ)","affiliations":[],"username":"david-eccles","link":null,"image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg"},"badges":[],"research_interests":null,"blocked_by_you":false,"blocked_you":false}],"versions":[],"groups":[],"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"can_be_copied":1,"can_remove_fork":1,"forks_count":{"private":0,"public":0},"access":{"can_view":1,"can_remove":0,"can_add":0,"can_edit":0,"can_publish":0,"can_get_doi":0,"can_share":1,"can_move":1,"can_move_outside":1,"can_transfer":1,"can_download":1,"is_locked":0},"steps":[{"id":791376,"guid":"7B20FF69CA5C4D45B9EB8224B5C5E7ED","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"D456CDA8B0004EF8A23EF733CF4FFAFE","order_id":1,"type_id":6,"title":"Section","source":{"title":"Generating Barcode Index"}},{"id":1054724,"guid":"9EDB087B486A4E308D369CF9780FCA27","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Prepare a FASTA file containing barcode sequences (see attached FASTA file). To reduce the chance of mismatched adapters, this should <\/span><span style = \"font-style:italic;\">only<\/span><span> contain the barcode sequences. That restriction means this approach will not work for short reads, where the barcode sequences are very likely to occur within sequences.<\/span><\/div><\/div>"}},{"id":1054725,"guid":"6D43E4F0241511E9B5045FC0FC2F250F","order_id":2,"type_id":23,"title":"file","source":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/bciwa.fa","placeholder":"\/img\/extensions\/file.png","original_name":"barcode_base.fa"}}],"cases":null,"data":null,"section":null,"section_color":"#A492FF","critical":null,"critical_id":null,"duration":0},{"id":791377,"guid":"DC94E7E9B9A645D0B499E3B12D0E5535","previous_id":791376,"previous_guid":"7B20FF69CA5C4D45B9EB8224B5C5E7ED","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"8099628BF15A456387C023ACBD33E2A2","order_id":1,"type_id":6,"title":"Section","source":{"title":"Generating Barcode Index"}},{"id":1054724,"guid":"4DCD968C38334327904320F654830322","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Prepare the LAST index for the barcode file. This will generate seven additional files of the form <index name>.XXX:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">lastdb barcode_base.fa barcode_base.fa<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null,"critical":null,"critical_id":null,"duration":0},{"id":791378,"guid":"392525F28CAF4D3DB5EF17B05AC6A02A","previous_id":791377,"previous_guid":"DC94E7E9B9A645D0B499E3B12D0E5535","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"D16981E5C2EE4FEF9BFA2763D9AD4001","order_id":1,"type_id":6,"title":"Section","source":{"title":"Mapping Reads to Barcodes"}},{"id":1054724,"guid":"A8789951E7C14FB89EF045B7DF670C89","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Combine all input reads into a single file<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">pv ..\/called_all\/*.fastq | gzip > reads_all.fastq.gz<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\"><span>Note: I'm using the pipe viewer command <\/span><span style = \"font-style:italic;\">pv<\/span><span> to produce a progress indicator while the command is running. If this command is not available, it can be replaced with <\/span><span style = \"font-style:italic;\">cat<\/span><span> with no change in function (apart from not showing progess).<\/span><\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":"#FFED92","critical":null,"critical_id":null,"duration":0},{"id":791379,"guid":"B7EB7183508D4A31BC49BAA2ACFDAB42","previous_id":791378,"previous_guid":"392525F28CAF4D3DB5EF17B05AC6A02A","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"A339FD1434D140EEBAA335C226AEE1E0","order_id":1,"type_id":6,"title":"Section","source":{"title":"Mapping Reads to Barcodes"}},{"id":1054724,"guid":"8BC263805A0E4473B28EE7863BFA005F","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Use LAST in FASTQ alignment mode (-Q 1) to map the reads. In this example, it is distributed over 10 processing threads (-P 10). Here <\/span><span style = \"font-style:italic;\">maf-convert<\/span><span> is used to convert to a single line per match, <\/span><span style = \"font-style:italic;\">cut<\/span><span> retains only the barcode and read IDs, and <\/span><span style = \"font-style:italic;\">uniq<\/span><span> is used to make sure that multiple same barcodes per read (e.g. for reverse \/ complement barcodes at each end) will not produce duplicates:<\/span><\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">lastal -Q 1 -P10 barcode_base.fa <(pv reads_all.fastq.gz) | \\<\/div><div class = \"text-block\">  maf-convert -n tab | cut -f 2,7 | uniq | \\<\/div><div class = \"text-block\">  gzip > barcode_assignments.txt.gz<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">For an extremely stringent search, the output of lastal can be piped through last-map-probs, which will reduce the likelihood of a partial barcode match to other DNA sequences. The downside is that this is more likely to drop reads due to slight mismatches in the barcode portion of the read:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\"><span>lastal -Q 1 -P10 barcode_base.fa <(pv reads_all.fastq.gz) | <\/span><span style = \"font-weight:bold;\">last-map-probs |<\/span><span> \\\n  maf-convert -n tab | cut -f 2,7 | uniq | \\\n  gzip > barcode_assignments.txt.gz<\/span><\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">The output of this command will be a gzipped tab-separated 2-column file with barcode names in the first column, and read IDs in the second column.<\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null,"critical":null,"critical_id":null,"duration":0},{"id":791381,"guid":"EADCB90BC8DE45CEB96AE7CEDD56AEBC","previous_id":791379,"previous_guid":"B7EB7183508D4A31BC49BAA2ACFDAB42","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"D9C945A005614120B44C866B04A4D5A3","order_id":1,"type_id":6,"title":"Section","source":{"title":"Splitting Read File Per Barcode"}},{"id":1054724,"guid":"195D41618618436CA5ADCE5BA04D1C31","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">For each discovered barcode, using the appropriate read category assignment file, find the corresponding read IDs, then extract those IDs out of the read FASTQ file. This uses one of my own scripts, <\/div><div class = \"text-block\"><a href=\"https:\/\/gitlab.com\/gringer\/bioinfscripts\/blob\/master\/fastx-fetch.pl\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">fastx-fetch.pl<\/span><\/a><\/div><div class = \"text-block\">, to do this directly from a FASTQ file:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">mkdir -p demultiplexed<\/div><div class = \"text-block\">fastx-fetch.pl -demultiplex barcode_assignments.txt.gz \\<\/div><div class = \"text-block\">  -prefix 'demultiplexed\/reads' <(pv reads_all.fastq.gz) > barcode_counts.txt<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\"><span>Note: this step discards chimeric reads that have multiple adapter sequences. If these reads are desired, then the <\/span><span style = \"font-style:italic;\">-chimeric<\/span><span> option can be added to the command arguments:<\/span><\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">mkdir -p demultiplexed<\/div><div class = \"text-block\"><span>fastx-fetch.pl -demultiplex barcode_assignments.txt.gz <\/span><span style = \"font-weight:bold;\">-chimeric<\/span><span> \\<\/span><\/div><div class = \"text-block\">  -prefix 'demultiplexed\/reads' <(pv reads_all.fastq.gz) > barcode_counts.txt<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":null,"data":null,"section":null,"section_color":null,"critical":null,"critical_id":null,"duration":0}],"materials":[],"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>This protocol is for a semi-manual method for read demultiplexing, as used after my presentation <\/span><span style = \"font-style:italic;\">Sequencing DNA with Linux Cores and Nanopores<\/span><span> to work out the number of reads captured by different barcodes.<\/span><\/div><div class = \"text-block\">Input: reads as a FASTQ file, barcode sequences as a FASTA file<\/div><div class = \"text-block\">Output: reads split into single FASTQ files per target [barcode]<\/div><div class = \"text-block\">Note: barcode \/ adapter sequences are not trimmed by this protocol<\/div><\/div>","changed_on":1564748139}